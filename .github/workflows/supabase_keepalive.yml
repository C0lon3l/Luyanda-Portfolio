name: üóÑÔ∏è Supabase Keepalive Ping
on:
  schedule:
    - cron: '0 0 */6 * *'
  workflow_dispatch:

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    steps:
      - name: üì° Ping Supabase Keepalive Function
        env: # Make the secret available as an environment variable
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          ENDPOINT="https://xomkewqnasftvovpuobu.supabase.co/rest/v1/rpc/keepalive"
          
          echo "Pinging: $ENDPOINT"
          
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "apikey: $SUPABASE_ANON_KEY" \
            -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
            "$ENDPOINT")
          
          echo "Response Code: $HTTP_CODE"
          
          if [ "$HTTP_CODE" -eq 200 ]; then
            echo "‚úÖ Success: Supabase project is active."
          elif [ "$HTTP_CODE" -eq 401 ]; then
            echo "‚ùå 401 Unauthorized. The SUPABASE_ANON_KEY secret may be incorrect."
            exit 1
          else
            echo "‚ùå Ping failed with HTTP code: $HTTP_CODE"
            exit 1
          fi
