<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luyanda Sonopo - Portfolio</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Poppins:wght@300;400;600;700&display=swap');

    :root {
      --bg-start: #0f172a;
      --bg-middle: #1e293b;
      --bg-end: #334155;
      --card: rgba(30, 41, 59, 0.95);
      --text: #f1f5f9;
      --nav: rgba(15, 23, 42, 0.9);
      --header: rgba(30, 41, 59, 0.95);
      --highlight: #ff6b6b;
      --accent: #4ecdc4;
      --folder-bg: linear-gradient(145deg, #1e293b, #0f172a);
      --footer-bg: linear-gradient(145deg, #1e293b, #0f172a);
      --footer-text: #f1f5f9;
      --shadow: rgba(0, 0, 0, 0.3);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(145deg, var(--bg-start), var(--bg-middle), var(--bg-end));
      background-size: 400% 400%;
      animation: gradientBG 20s ease infinite;
      color: var(--text);
      transition: all 0.4s ease;
      scroll-behavior: smooth;
      line-height: 1.6;
      min-height: 100vh;
    }

    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    header {
      background: var(--header);
      color: white;
      padding: 40px 30px;
      text-align: center;
      box-shadow: 0 8px 25px var(--shadow);
      border-bottom-left-radius: 25px;
      border-bottom-right-radius: 25px;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }
    
    header h1 { font-size: 3em; margin: 0; letter-spacing: 1.5px; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
    header p { font-size: 1.3em; margin-top: 10px; font-weight: 400; opacity: 0.9; }

    nav {
      background: var(--nav);
      display: flex;
      justify-content: center;
      gap: 30px;
      padding: 15px;
      align-items: center;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 15px var(--shadow);
      margin-bottom: 40px;
      backdrop-filter: blur(10px);
      flex-wrap: wrap;
    }
    
    .nav-link { 
      color: white; 
      text-decoration: none; 
      font-weight: 600; 
      padding: 10px 20px; 
      border-radius: 12px; 
      transition: all 0.3s; 
      position: relative;
      overflow: hidden;
      cursor: pointer;
      background: none;
      border: none;
      font-family: inherit;
      font-size: inherit;
    }
    
    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 3px;
      background: var(--accent);
      transition: width 0.3s;
    }
    
    .nav-link.active, .nav-link:hover { 
      background: rgba(255, 255, 255, 0.15); 
      color: #fff; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
    }
    
    .nav-link.active::after, .nav-link:hover::after { width: 100%; }

    .section { 
      max-width: 1000px; 
      margin: 50px auto; 
      background: var(--card); 
      padding: 40px; 
      border-radius: 20px; 
      box-shadow: 0 12px 30px var(--shadow); 
      transition: all 0.4s; 
      position: relative; 
      overflow: hidden;
      backdrop-filter: blur(10px);
    }
    
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--highlight), var(--accent));
    }
    
    .section h2 { 
      font-size: 2.2em; 
      margin-bottom: 25px; 
      color: var(--highlight);
      position: relative;
      display: inline-block;
    }
    
    .section h2::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 50%;
      height: 3px;
      background: var(--accent);
    }

    /* About Section Styles */
    .about-content {
      font-size: 1.1em;
      line-height: 1.8;
    }

    .about-section {
      margin-bottom: 40px;
    }

    .about-section:last-child {
      margin-bottom: 0;
    }

    .about-section h3 {
      color: var(--accent);
      margin-bottom: 15px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .about-section h3::before {
      font-size: 1.2em;
    }

    .intro h3::before { content: 'üëã'; }
    .truth h3::before { content: 'üí°'; }
    .journey h3::before { content: 'üöÄ'; }
    .beyond h3::before { content: 'üé®'; }
    .now h3::before { content: 'üåü'; }

    .highlight-box {
      background: linear-gradient(145deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
      padding: 25px;
      border-radius: 15px;
      border-left: 4px solid var(--highlight);
      margin: 20px 0;
    }

    .quote {
      font-style: italic;
      text-align: center;
      font-size: 1.2em;
      margin: 30px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      border-left: 4px solid var(--accent);
    }

    .skills-pill {
      display: inline-block;
      background: rgba(255, 255,255, 0.1);
      padding: 8px 16px;
      border-radius: 20px;
      margin: 5px;
      font-size: 0.9em;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .contact-links {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .contact-btn {
      background: var(--accent);
      color: white;
      text-decoration: none;
      padding: 12px 25px;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      border: none;
      cursor: pointer;
      font-family: inherit;
    }

    .contact-btn:hover {
      background: #3db8ac;
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.2);
    }

    .contact-btn.primary {
      background: var(--highlight);
    }

    .contact-btn.primary:hover {
      background: #ff5252;
    }

    .breadcrumb {
      margin-bottom: 20px;
      font-size: 0.95em;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .breadcrumb span {
      cursor: pointer;
      transition: all 0.3s;
    }

    .breadcrumb span:hover {
      color: var(--highlight);
      text-decoration: underline;
    }

    .breadcrumb-separator {
      color: var(--text);
      opacity: 0.5;
    }

    .folder { 
      border-radius: 18px; 
      margin-bottom: 25px; 
      margin-top: 15px;
      position: relative; 
      box-shadow: 0 8px 25px var(--shadow); 
      background: var(--folder-bg); 
      color: #fff; 
      font-weight: 700; 
      text-shadow: 1px 1px 4px rgba(0,0,0,0.3); 
      transition: all 0.3s; 
      padding: 25px; 
      overflow: hidden;
      cursor: pointer;
    }
    
    .folder::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
      pointer-events: none;
    }
    
    .folder:hover { 
      transform: translateY(-7px); 
      box-shadow: 0 15px 35px rgba(0,0,0,0.25); 
    }
    
    .folder h3 { 
      margin: 0; 
      font-size: 1.5em; 
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
    }
    
    .folder h3::before { content: 'üìÅ'; margin-right: 10px; font-size: 1.2em; }

    .file-item { 
      padding: 12px 15px; 
      border-bottom: 1px solid rgba(255,255,255,0.1); 
      transition: all 0.3s; 
      border-radius: 8px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(0,0,0,0.2);
    }
    
    .file-item::before { content: 'üìÑ'; margin-right: 10px; }
    
    .file-item span { flex-grow: 1; }
    
    .file-item:hover { background: rgba(255,255,255,0.05); padding-left: 20px; transform: translateX(5px); }

    .folder-item { 
      padding: 15px 20px; 
      border-bottom: 1px solid rgba(255,255,255,0.1); 
      transition: all 0.3s; 
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(0,0,0,0.3);
      cursor: pointer;
    }
    
    .folder-item::before { content: 'üìÅ'; margin-right: 10px; font-size: 1.2em; }
    
    .folder-item:hover { background: rgba(255,255,255,0.05); padding-left: 25px; transform: translateX(5px); }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text);
      opacity: 0.6;
      font-style: italic;
    }

    .empty-state::before {
      content: 'üìÇ';
      display: block;
      font-size: 4em;
      margin-bottom: 15px;
    }

    /* Download button only - no delete */
    .download-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
    }

    .download-btn:hover {
      background: #3db8ac;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* Resume specific styles */
    .resume-container {
      text-align: center;
      padding: 30px;
    }

    .resume-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .action-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }

    .action-btn:hover {
      background: #3db8ac;
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.2);
    }

    .action-btn.view {
      background: var(--highlight);
    }

    .action-btn.view:hover {
      background: #ff5252;
    }

    .no-resume {
      text-align: center;
      padding: 50px 20px;
      color: var(--text);
      opacity: 0.7;
      font-style: italic;
    }

    .no-resume::before {
      content: 'üìÑ';
      font-size: 3em;
      display: block;
      margin-bottom: 15px;
    }

    .resume-info {
      background: rgba(0,0,0,0.2);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .resume-info h3 {
      color: var(--accent);
      margin-bottom: 10px;
    }

    /* Toast notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      background: #e53e3e;
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 9999;
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      background: #38a169;
    }

    .toast.info {
      background: #3182ce;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }

    /* Loading spinner */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 42, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9998;
      backdrop-filter: blur(5px);
    }

    .loading-spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid var(--accent);
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .logout-btn {
      margin-left: auto;
      background: rgba(255, 107, 107, 0.2) !important;
    }

    .logout-btn:hover {
      background: rgba(255, 107, 107, 0.3) !important;
    }

    footer { 
      background: var(--footer-bg); 
      color: var(--footer-text); 
      padding: 40px; 
      text-align: center; 
      font-weight: 600; 
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3); 
      box-shadow: 0 8px 25px var(--shadow); 
      border-top-left-radius: 25px; 
      border-top-right-radius: 25px; 
      margin-top: 80px; 
      backdrop-filter: blur(10px);
    }
    
    footer span { 
      font-family: 'Courier New', monospace; 
      font-size: 1.4em; 
      padding: 6px 15px; 
      border-radius: 8px; 
      background: linear-gradient(90deg, var(--highlight), var(--accent));
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    @media (max-width: 768px) {
      header h1 { font-size: 2.2em; }
      header p { font-size: 1.1em; }
      nav { gap: 15px; padding: 12px; }
      .nav-link { padding: 8px 15px; font-size: 0.9em; }
      .section { padding: 25px; margin: 30px 15px; }
      .section h2 { font-size: 1.8em; }
      .folder { padding: 20px; }
      .resume-actions { flex-direction: column; }
      .action-btn { width: 100%; justify-content: center; }
      .contact-links { flex-direction: column; }
      .contact-btn { width: 100%; justify-content: center; }
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .folder, .file-item, .folder-item { animation: fadeIn 0.5s ease; }

    .section.highlight { animation: highlightFade 1s ease forwards; }
    @keyframes highlightFade { 0% { background-color: rgba(255, 107, 107, 0.15); } 100% { background-color: transparent; } }
  </style>
</head>
<body>
  <header>
    <h1>Luyanda Sonopo</h1>
    <p>Developer ‚Ä¢ Writer ‚Ä¢ Creative</p>
  </header>

  <nav>
    <button class="nav-link" onclick="navigateTo('about')" class="active">About</button>
    <button class="nav-link" onclick="enterFolder('projects')">Projects</button>
    <button class="nav-link" onclick="enterFolder('practice')">Practice Code</button>
    <button class="nav-link" onclick="navigateTo('resume')">Resume</button>
    <button class="nav-link logout-btn" onclick="logout()">
      üîí Logout
    </button>
  </nav>

  <div id="mainContent"></div>

  <footer>
    <p>¬© 2025 <span>Luyanda Sonopo</span></p>
    <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.7;">
      Guest Access ‚Ä¢ View Only
    </p>
  </footer>

  <script>
    // ========== HIGH-PERFORMANCE CONFIGURATION ==========
    console.log('üöÄ Optimized Portfolio v2.0');

    // Cache system
    const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes
    const API_CACHE = {
      resume: { data: null, timestamp: 0 },
      projects: { data: null, timestamp: 0 },
      practice: { data: null, timestamp: 0 },
      folders: {}
    };

    let currentView = 'about';
    let currentPath = [];
    let folders = [];
    let files = [];
    let isLoading = false;

    // ========== PREVIEW MODAL SYSTEM ==========
    function createPreviewModal() {
      let modal = document.getElementById('previewModal');
      if (modal) return modal;
      
      modal = document.createElement('div');
      modal.id = 'previewModal';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.98);
        z-index: 10000;
        display: none;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(10px);
      `;
      
      modal.innerHTML = `
        <div style="position: relative; max-width: 95vw; max-height: 95vh; background: var(--card); border-radius: 15px; overflow: hidden; box-shadow: 0 25px 75px rgba(0,0,0,0.5);">
          <button id="closePreview" style="position: absolute; top: 15px; right: 15px; background: var(--highlight); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; z-index: 10001; font-size: 1.2em; display: flex; align-items: center; justify-content: center;">
            ‚úï
          </button>
          <div id="previewContent" style="max-height: 85vh; overflow: auto;"></div>
          <div id="previewInfo" style="background: rgba(0,0,0,0.3); padding: 15px; text-align: center; border-top: 1px solid rgba(255,255,255,0.1);">
            <div id="previewFileName" style="font-weight: 600; margin-bottom: 5px;"></div>
            <div id="previewFileInfo" style="font-size: 0.9em; opacity: 0.8;"></div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Close modal on click
      modal.querySelector('#closePreview').addEventListener('click', hidePreview);
      modal.addEventListener('click', (e) => {
        if (e.target === modal) hidePreview();
      });
      
      // Close on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') hidePreview();
      });
      
      return modal;
    }

    function showPreview(file) {
      const modal = createPreviewModal();
      const previewContent = modal.querySelector('#previewContent');
      const previewFileName = modal.querySelector('#previewFileName');
      const previewFileInfo = modal.querySelector('#previewFileInfo');
      
      const fileType = file.file_type || '';
      const fileUrl = `/api/files/${file.filename}`;
      const fileName = file.original_name || file.filename;
      
      // Update file info
      previewFileName.textContent = fileName;
      previewFileInfo.innerHTML = `
        ${fileType || 'Unknown type'} 
        ${file.file_size ? ` ‚Ä¢ ${formatFileSize(file.file_size)}` : ''}
        ${file.upload_date ? ` ‚Ä¢ ${formatDate(file.upload_date)}` : ''}
      `;
      
      let previewHTML = '';
      
      if (fileType.startsWith('image/')) {
        // Image preview
        previewHTML = `
          <img src="${fileUrl}" 
               alt="${fileName}"
               style="max-width: 100%; max-height: 70vh; display: block; margin: 0 auto; padding: 20px;"
               onload="this.style.opacity='1'"
               onerror="this.onerror=null;this.parentElement.innerHTML='<div style=\\'padding: 60px; text-align: center;\\'><div style=\\'font-size: 3em; margin-bottom: 20px;\\'>üñºÔ∏è</div><p>Image could not be loaded</p><p style=\\'font-size: 0.9em; opacity: 0.7; margin-top: 10px;\\'>Try downloading the file instead</p></div>';" 
               style="opacity:0;transition:opacity 0.3s">
        `;
      } else if (fileType.includes('pdf')) {
        // PDF preview - SAFER approach for Brave browser
        previewHTML = `
          <div style="padding: 40px 20px; text-align: center;">
            <div style="font-size: 5em; margin-bottom: 30px; color: var(--accent);">
              üìï
            </div>
            <h3 style="margin-bottom: 15px; color: var(--text);">${fileName}</h3>
            <p style="color: var(--text); opacity: 0.8; margin-bottom: 25px; max-width: 600px; margin-left: auto; margin-right: auto;">
              For security reasons, PDFs cannot be previewed directly in the browser.<br>
              Please choose an option below:
            </p>
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
              <a href="${fileUrl}" 
                 download 
                 style="background: var(--accent); color: white; padding: 12px 25px; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 8px;">
                üì• Download PDF
              </a>
              <button onclick="window.open('${fileUrl}', '_blank'); hidePreview();" 
                      style="background: #8b5cf6; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; gap: 8px;">
                üîó Open in New Tab
              </button>
              <button onclick="hidePreview()" 
                      style="background: rgba(255, 255, 255, 0.1); color: var(--text); border: 1px solid rgba(255,255,255,0.2); padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                Close
              </button>
            </div>
            <div style="margin-top: 30px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px; max-width: 600px; margin-left: auto; margin-right: auto;">
              <p style="font-size: 0.9em; opacity: 0.7; margin: 0;">
                <strong>Note:</strong> Some browsers block PDF previews for security. 
                This is a browser security feature, not an issue with this website.
              </p>
            </div>
          </div>
        `;
      } else {
        // Generic file preview (for non-image/PDF files)
        previewHTML = `
          <div style="padding: 60px 40px; text-align: center;">
            <div style="font-size: 5em; margin-bottom: 30px; opacity: 0.8;">
              ${getFileIcon(fileType)}
            </div>
            <h3 style="margin-bottom: 15px; color: var(--text);">${fileName}</h3>
            <p style="color: var(--text); opacity: 0.8; margin-bottom: 30px;">
              This file type cannot be previewed in the browser.<br>
              Download the file to view its contents.
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
              <a href="${fileUrl}" 
                 download 
                 style="background: var(--accent); color: white; padding: 12px 25px; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 8px;">
                üì• Download File
              </a>
              <button onclick="hidePreview()" 
                      style="background: rgba(255, 255, 255, 0.1); color: var(--text); border: 1px solid rgba(255,255,255,0.2); padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                Close
              </button>
            </div>
          </div>
        `;
      }
      
      previewContent.innerHTML = previewHTML;
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function hidePreview() {
      const modal = document.getElementById('previewModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    }

    // ========== PERFORMANCE UTILITIES ==========
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // ========== UI UTILITIES ==========
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function showLoading(show = true) {
      let overlay = document.getElementById('loadingOverlay');
      
      if (show) {
        if (!overlay) {
          overlay = document.createElement('div');
          overlay.id = 'loadingOverlay';
          overlay.className = 'loading-overlay';
          overlay.innerHTML = '<div class="loading-spinner"></div>';
          document.body.appendChild(overlay);
        }
        overlay.style.display = 'flex';
      } else if (overlay) {
        overlay.style.display = 'none';
      }
    }

    // ========== ACCESS CONTROL ==========
    window.addEventListener('DOMContentLoaded', () => {
      const access = sessionStorage.getItem('portfolioAccess');
      if (access !== 'guest') {
        window.location.href = '/';
        return;
      }
      
      // Preload data in background for instant navigation
      setTimeout(() => preloadAllData(), 100);
      
      navigateTo('about');
    });

    function logout() {
      sessionStorage.removeItem('portfolioAccess');
      window.location.href = '/';
    }

    // ========== BACKGROUND PRELOADING ==========
    async function preloadAllData() {
      // Preload resume (most important)
      try {
        const resume = await fetchWithCache('/api/resume', 'resume');
        if (resume && resume.id) {
          API_CACHE.resume.data = resume;
          API_CACHE.resume.timestamp = Date.now();
          console.log('‚ö° Resume preloaded');
        }
      } catch (error) {
        console.log('Preload resume failed:', error);
      }
      
      // Preload projects data
      setTimeout(() => {
        fetchWithCache('/api/files?category=projects', 'projects')
          .then(data => {
            if (data) {
              API_CACHE.projects.data = data;
              API_CACHE.projects.timestamp = Date.now();
              console.log('‚ö° Projects preloaded');
            }
          })
          .catch(() => {});
      }, 500);
    }

    // ========== OPTIMIZED NAVIGATION ==========
    const navigateTo = debounce(function(view, path = []) {
      if (isLoading) return;
      
      currentView = view;
      currentPath = path || [];
      
      // Update active nav link
      document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
      const navIndex = {
        'about': 0,
        'projects': 1,
        'practice': 2,
        'resume': 3
      }[view];
      
      if (navIndex !== undefined) {
        const navLinks = document.querySelectorAll('.nav-link');
        if (navLinks[navIndex]) {
          navLinks[navIndex].classList.add('active');
        }
      }
      
      renderWithCache();
    }, 100);

    function enterFolder(folderType) {
      currentView = folderType;
      currentPath = [];
      loadDataWithCache().then(() => {
        navigateTo(folderType);
      });
    }

    // ========== OPTIMIZED DATA LOADING ==========
    async function fetchWithCache(url, cacheKey) {
      const now = Date.now();
      
      // Check cache first
      if (API_CACHE[cacheKey] && API_CACHE[cacheKey].data && 
          (now - API_CACHE[cacheKey].timestamp) < CACHE_DURATION) {
        console.log('‚ö° Cache hit:', cacheKey);
        return API_CACHE[cacheKey].data;
      }
      
      // Fetch fresh data
      try {
        const response = await fetch(url);
        if (response.ok) {
          const data = await response.json();
          
          // Cache the data
          API_CACHE[cacheKey] = {
            data: data,
            timestamp: now
          };
          
          console.log('üì• Fresh data loaded:', cacheKey);
          return data;
        }
      } catch (error) {
        console.error('Fetch error:', error);
      }
      
      // Return cached data even if expired
      return API_CACHE[cacheKey] ? API_CACHE[cacheKey].data : null;
    }

    async function loadDataWithCache() {
      if (isLoading) return;
      isLoading = true;
      
      try {
        if (currentView === 'projects' || currentView === 'practice') {
          const cacheKey = currentView;
          const pathKey = currentPath.join('/') || 'root';
          const fullCacheKey = `${cacheKey}_${pathKey}`;
          
          // Try to get folders and files in parallel
          const [foldersData, filesData] = await Promise.allSettled([
            fetchWithCache(`/api/folders?category=${currentView}&parentPath=${currentPath.join('/')}`, `folders_${fullCacheKey}`),
            fetchWithCache(`/api/files?category=${currentView}&folderPath=${currentPath.join('/')}`, `files_${fullCacheKey}`)
          ]);
          
          folders = foldersData.status === 'fulfilled' ? (foldersData.value || []) : [];
          files = filesData.status === 'fulfilled' ? (filesData.value || []) : [];
        } else if (currentView === 'resume') {
          const resumeData = await fetchWithCache('/api/resume', 'resume');
          files = resumeData && resumeData.id ? [resumeData] : [];
        }
      } catch (error) {
        console.error('Load error:', error);
        folders = [];
        files = [];
      } finally {
        isLoading = false;
      }
    }

    // ========== INSTANT RENDER WITH CACHE ==========
    function renderWithCache() {
      const content = document.getElementById('mainContent');
      if (!content) return;
      
      // Show immediate cached content
      if (currentView === 'resume' && API_CACHE.resume.data) {
        files = API_CACHE.resume.data.id ? [API_CACHE.resume.data] : [];
        renderResume(content);
      } else if (currentView === 'projects' && API_CACHE.projects.data) {
        files = API_CACHE.projects.data;
        renderInsideFolder(content);
      } else {
        // Show loading state for uncached content
        if (currentView === 'about') {
          renderAbout(content);
        } else {
          content.innerHTML = `
            <div class="section">
              <h2>${currentView === 'projects' ? 'Project Folders' : currentView === 'practice' ? 'Practice Code' : 'Resume'}</h2>
              <div style="text-align: center; padding: 50px;">
                <div class="loading" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                <p>Loading...</p>
              </div>
            </div>
          `;
        }
      }
      
      // Load fresh data in background
      loadDataWithCache().then(() => {
        if (currentView !== 'about') {
          render();
        }
      });
    }

    // ========== RENDER FUNCTIONS ==========
    function render() {
      const content = document.getElementById('mainContent');
      if (!content) return;
      
      if (currentView === 'about') {
        renderAbout(content);
      } else if (currentView === 'resume') {
        renderResume(content);
      } else {
        renderInsideFolder(content);
      }
    }

    function renderAbout(container) {
      container.innerHTML = `
        <div class="section">
          <h2>About Me</h2>
          <div class="about-content">
            
            <div class="about-section intro">
              <h3>Hi, I'm Luyanda Sonopo</h3>
              <p>Part software developer, part storyteller, part music-maker, full-time human who has consumed enough anime to be considered 70% animated at this point.</p>
              
              <p>I'm a Computer Science and Information Technology graduate from the University of KwaZulu-Natal, and I currently exist somewhere between logic, creativity, and whatever wild idea my brain decides to chase next.</p>
            </div>

            <div class="about-section truth">
              <h3>Let's get something out of the way</h3>
              <div class="highlight-box">
                <p><strong>I did not build this website.</strong></p>
                <p>Front-end is not my expertise ‚Äî not yet, anyway. I don't know HTML, CSS, or JavaScript, and I'm not ashamed to say that.</p>
                <p>My strengths live on the back-end, where I'm most fluent in 
                  <span class="skills-pill">Java</span>. I'm fascinated by how things work, not how they look. The logic, the patterns, the behaviour ‚Äî that's where I feel at home. But I'm always learning, always growing, and I'm definitely interested in front-end in the future. My learning journey never ends.</p>
              </div>
            </div>

            <div class="about-section journey">
              <h3>Where it all started</h3>
              <p>My path to software development started way before I touched my first IDE.</p>
              <p>As a kid, I tore apart every gadget I could find ‚Äî remotes, toys, phones, anything with screws. Not because I loved hardware, but because I genuinely thought I'd open it and see the logic inside. I wanted to understand how things worked.</p>
              
              <div class="quote">
                "I wanted to build the logic that makes things come alive."
              </div>
              
              <p>Growing up, I discovered something called software ‚Äî the invisible brain behind everything I couldn't find in the hardware. And just like that, it clicked. That's when I knew:</p>
            </div>

            <div class="about-section beyond">
              <h3>Beyond the code</h3>
              <p>Outside of development, I'm a crazy anime fan. I love stories ‚Äî big worlds, intense emotions, quiet moments, absurd plots, all of it. Anime shapes a lot of my creativity.</p>
              
              <p>I'm also a writer. I write books, lyrics, and sometimes novels I almost finish but never quite bring to the end‚Ä¶ and that's okay. Creativity isn't always linear. Sometimes it's just vibes.</p>
              
              <p>Music is another part of me ‚Äî I enjoy listening to it, feeling it, and creating lyrics when the inspiration hits.</p>
            </div>

            <div class="about-section now">
              <h3>And now we're here</h3>
              <div class="highlight-box">
                <p><strong>Everything you see inside this website ‚Äî the writing, the content, the thoughts ‚Äî is entirely my creation.</strong></p>
                <p>No plagiarism. No shortcuts. No copy-paste magic. Just me.</p>
              </div>
              
              <p style="text-align: center; font-size: 1.2em; margin-top: 30px;">
                <em>Welcome to my world ‚Äî the logic, the art, and the beautiful chaos in between.</em>
              </p>
            </div>

            <div class="contact-links">
              <a href="mailto:luyandasonopo@example.com" class="contact-btn primary">
                üìß Get In Touch
              </a>
              <button class="contact-btn" onclick="enterFolder('projects')">
                üíº View My Projects
              </button>
            </div>

          </div>
        </div>
      `;
    }

    function renderResume(container) {
      const hasResume = files.length > 0 && files[0] && files[0].id && files[0].filename;
      const resume = hasResume ? files[0] : null;
      
      container.innerHTML = `
        <div class="section">
          <h2>Resume</h2>
          <div class="resume-container">
            ${hasResume ? `
              <div class="resume-info">
                <h3>Current Resume</h3>
                <p><strong>File:</strong> ${resume.original_name || resume.filename || 'Unknown'}</p>
                <p><strong>Size:</strong> ${resume.file_size ? formatFileSize(resume.file_size) : 'Unknown'}</p>
                <p><strong>Uploaded:</strong> ${resume.upload_date ? formatDate(resume.upload_date) : 'Unknown date'}</p>
                <p><em>Loaded from ${API_CACHE.resume.timestamp ? 'cache' : 'server'}</em></p>
              </div>
              <div class="resume-actions">
                <a href="/api/files/${resume.filename}" download class="action-btn">
                  üì• Download Resume
                </a>
                <button class="action-btn view" onclick="showPreview(${JSON.stringify(resume).replace(/"/g, '&quot;')})">
                  üìÑ View Options
                </button>
              </div>
            ` : `
              <div class="no-resume">
                <p>No resume uploaded yet</p>
                <p style="margin-top: 20px; font-size: 0.9em; opacity: 0.7;">
                  Contact me for my latest resume
                </p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderInsideFolder(container) {
      const title = currentPath.length > 0 ? currentPath[currentPath.length - 1] : 
                   (currentView === 'projects' ? 'Project Folders' : 'Practice Code');
      const breadcrumbHTML = renderBreadcrumb();
      
      let foldersHTML = '';
      folders.forEach((folder) => {
        foldersHTML += `
          <div class="folder-item" onclick="openFolder('${folder.name}')">
            <span style="flex-grow:1;">${folder.name}</span>
          </div>
        `;
      });

      let filesHTML = '';
      files.forEach((file) => {
        const icon = getFileIcon(file.file_type);
        const fileType = file.file_type || '';
        const canPreview = fileType.startsWith('image/') || fileType.includes('pdf');
        
        filesHTML += `
          <div class="file-item">
            <span>${icon}</span>
            <span>${file.original_name || file.filename}</span>
            <span style="font-size: 0.9em; opacity: 0.7; margin: 0 10px;">
              ${file.file_size ? formatFileSize(file.file_size) : ''}
            </span>
            <div style="display: flex; gap: 8px;">
              ${canPreview ? `
                <button class="preview-btn" 
                        onclick="showPreview(${JSON.stringify(file).replace(/"/g, '&quot;')})"
                        style="background: #8b5cf6; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em; transition: all 0.3s; display: inline-flex; align-items: center; gap: 5px;">
                  üëÅÔ∏è Preview
                </button>
              ` : ''}
              <a href="/api/files/${file.filename}" download class="download-btn">
                üì• Download
              </a>
            </div>
          </div>
        `;
      });

      const emptyHTML = (!foldersHTML && !filesHTML) ? '<div class="empty-state">This folder is empty</div>' : '';

      container.innerHTML = `
        <div class="section">
          <h2>${title}</h2>
          ${breadcrumbHTML}
          ${foldersHTML}
          ${filesHTML}
          ${emptyHTML}
        </div>
      `;
    }

    // ========== HELPER FUNCTIONS ==========
    function getFileIcon(fileType) {
      if (!fileType) return 'üìÑ';
      if (fileType.startsWith('image/')) return 'üñºÔ∏è';
      if (fileType.startsWith('video/')) return 'üé•';
      if (fileType.startsWith('audio/')) return 'üéµ';
      if (fileType.includes('pdf')) return 'üìï';
      if (fileType.includes('word') || fileType.includes('document')) return 'üìÑ';
      if (fileType.includes('zip') || fileType.includes('archive')) return 'üì¶';
      if (fileType.includes('text')) return 'üìù';
      if (fileType.includes('java')) return '‚òï';
      return 'üìÑ';
    }

    function formatFileSize(bytes) {
      if (!bytes) return '0 KB';
      const bytesNum = parseInt(bytes);
      if (bytesNum < 1024) return bytesNum + ' B';
      if (bytesNum < 1024 * 1024) return (bytesNum / 1024).toFixed(1) + ' KB';
      return (bytesNum / (1024 * 1024)).toFixed(1) + ' MB';
    }

    function formatDate(dateString) {
      if (!dateString) return 'Unknown';
      try {
        const date = new Date(dateString);
        return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      } catch {
        return 'Invalid date';
      }
    }

    function renderBreadcrumb() {
      if (currentPath.length === 0) return '';
      
      let breadcrumb = '<div class="breadcrumb">';
      const rootName = currentView === 'projects' ? 'Project Folders' : 'Practice Code';
      breadcrumb += `<span onclick="enterFolder('${currentView}')">${rootName}</span>`;
      
      for (let i = 0; i < currentPath.length; i++) {
        breadcrumb += ' <span class="breadcrumb-separator">/</span> ';
        if (i === currentPath.length - 1) {
          breadcrumb += `<span style="color: var(--text);">${currentPath[i]}</span>`;
        } else {
          breadcrumb += `<span onclick="navigateToPath('${currentView}', ${JSON.stringify(currentPath.slice(0, i + 1))})">${currentPath[i]}</span>`;
        }
      }
      
      breadcrumb += '</div>';
      return breadcrumb;
    }

    const navigateToPath = debounce(function(view, path) {
      currentView = view;
      currentPath = path;
      loadDataWithCache().then(() => {
        render();
      });
    }, 100);

    function openFolder(folderName) {
      currentPath.push(folderName);
      loadDataWithCache().then(() => {
        render();
      });
    }

    // ========== PERFORMANCE MONITORING ==========
    if (typeof PerformanceObserver !== 'undefined') {
      const observer = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          console.log(`‚è±Ô∏è ${entry.name}: ${entry.duration.toFixed(2)}ms`);
        }
      });
      observer.observe({ entryTypes: ['measure', 'navigation', 'resource'] });
    }
  </script>
</body>
</html>